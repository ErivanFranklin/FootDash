name: Example Staging Deploy (Secrets + Environment)

on:
  workflow_dispatch: {}

jobs:
  deploy:
    name: Example deploy to `staging` environment
    runs-on: ubuntu-latest
    environment: staging
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: Install backend deps
        run: |
          cd backend
          npm ci

      - name: Sanity check FCM secrets (safe)
        # This step demonstrates how to map secrets. Do NOT print sensitive values in real workflows.
        env:
          FCM_PROJECT_ID: ${{ secrets.FCM_PROJECT_ID }}
          FCM_CLIENT_EMAIL: ${{ secrets.FCM_CLIENT_EMAIL }}
          # FCM_PRIVATE_KEY should NOT be echoed to logs
          MONITORING_WEBHOOK_URL: ${{ secrets.MONITORING_WEBHOOK_URL }}
        run: |
          echo "Sanity: FCM_PROJECT_ID=${FCM_PROJECT_ID:-<missing>}"
          echo "Sanity: FCM_CLIENT_EMAIL=${FCM_CLIENT_EMAIL:-<missing>}"
          if [ -n "$MONITORING_WEBHOOK_URL" ]; then echo "Sanity: MONITORING_WEBHOOK_URL is set"; else echo "MONITORING_WEBHOOK_URL is not set"; fi

      - name: Example deploy step (placeholder)
        run: |
          echo "Run your deployment here. This workflow is an example showing environment and secrets mapping."
