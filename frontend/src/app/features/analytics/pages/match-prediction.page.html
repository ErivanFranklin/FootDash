<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <!-- Default back to home since we don't know teamId context easily here without more work -->
      <ion-back-button defaultHref="/home"></ion-back-button>
    </ion-buttons>
    <ion-title>{{ 'ANALYTICS.TITLE' | transloco }}</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <div class="page-container">
    <!-- Loading State -->
    <div *ngIf="loading" class="loading-container">
      <ion-spinner name="crescent"></ion-spinner>
      <p>{{ 'ANALYTICS.LOADING' | transloco }}</p>
    </div>

    <!-- Match Content -->
    <ng-container *ngIf="match$ | async as match">
      <div *ngIf="match" class="match-header">
        <h2>{{ match.homeTeam.name }} vs {{ match.awayTeam.name }}</h2>
        <p *ngIf="match.kickOff" class="match-time">
          {{ match.kickOff | date: 'medium' }}
        </p>
        <p *ngIf="match.status" class="match-status">
          {{ 'ANALYTICS.STATUS' | transloco }} {{ match.status }}
        </p>
      </div>

      <!-- Prediction Card -->
      <app-prediction-card
        *ngIf="match"
        [matchId]="match.id"
        [showDetails]="true"
      ></app-prediction-card>

      <!-- Team Comparison -->
      <app-team-comparison
        *ngIf="match"
        [homeTeamId]="match.homeTeam.id"
        [awayTeamId]="match.awayTeam.id"
      ></app-team-comparison>

      <!-- Detailed Team Analysis -->
      <ion-accordion-group expand="inset" class="team-details-accordion">
        <ion-accordion value="home">
          <ion-item slot="header" color="light">
            <ion-label>{{ match.homeTeam.name }} - {{ 'ANALYTICS.ANALYSIS' | transloco }}</ion-label>
          </ion-item>
          <div class="ion-padding" slot="content">
            <app-team-analytics-card
              [teamId]="match.homeTeam.id"
              [showCharts]="true"
            ></app-team-analytics-card>
          </div>
        </ion-accordion>

        <ion-accordion value="away">
          <ion-item slot="header" color="light">
            <ion-label>{{ match.awayTeam.name }} - {{ 'ANALYTICS.ANALYSIS' | transloco }}</ion-label>
          </ion-item>
          <div class="ion-padding" slot="content">
            <app-team-analytics-card
              [teamId]="match.awayTeam.id"
              [showCharts]="true"
            ></app-team-analytics-card>
          </div>
        </ion-accordion>
      </ion-accordion-group>
    </ng-container>

    <!-- Error State -->
    <div *ngIf="!loading && (match$ | async) === null" class="error-container">
      <p>Unable to load match data</p>
    </div>
  </div>
</ion-content>
