<app-page-header title="Match Details" />

<ion-content>
  <div style="display:flex;align-items:center;gap:8px;padding:12px 16px;">
    <ion-badge *ngIf="(connectionStatus$ | async) as status">Connection: {{ status }}</ion-badge>
    <ion-spinner *ngIf="(connectionStatus$ | async) === 'connecting'" name="dots"></ion-spinner>
  </div>

  <div *ngIf="match$ | async as match" class="match-details">
    <section class="teams-row">
      <div class="team home">
        <div class="team-avatar">
          <img *ngIf="match.homeLogo" [src]="match.homeLogo" alt="{{ match.homeName }} logo" class="team-logo" loading="lazy" (load)="onLogoLoaded('home')" />
          <div *ngIf="!match.homeLogo && !homeLogoLoaded" class="avatar-skeleton"></div>
          <div *ngIf="!match.homeLogo && homeLogoLoaded" class="avatar-fallback">{{ (match.homeName || 'H').substring(0,2) }}</div>
        </div>
        <div class="team-name">{{ match.homeTeam?.name || match.home?.name || match.homeName || 'Home' }}</div>
      </div>

      <div class="score">
        <div class="score-value">{{ match.homeScore ?? match.score?.home ?? '-' }} : {{ match.awayScore ?? match.score?.away ?? '-' }}</div>
        <div class="status">
          <ion-badge color="primary">{{ match.status || match.fixture?.status || 'N/A' }}</ion-badge>
        </div>
      </div>

      <div class="team away">
        <div class="team-avatar">
          <img *ngIf="match.awayLogo" [src]="match.awayLogo" alt="{{ match.awayName }} logo" class="team-logo" loading="lazy" (load)="onLogoLoaded('away')" />
          <div *ngIf="!match.awayLogo && !awayLogoLoaded" class="avatar-skeleton"></div>
          <div *ngIf="!match.awayLogo && awayLogoLoaded" class="avatar-fallback">{{ (match.awayName || 'A').substring(0,2) }}</div>
        </div>
        <div class="team-name">{{ match.awayTeam?.name || match.away?.name || match.awayName || 'Away' }}</div>
      </div>
    </section>

    <section class="meta">
      <div class="meta-row"><strong>Kickoff:</strong>
        <span>{{ (match.kickOff || match.kickoff || match.fixture?.date) | date:'short' }}</span>
      </div>
      <div class="meta-row" *ngIf="match.venue?.name"><strong>Venue:</strong> <span>{{ match.venue?.name }}</span></div>
      <div class="meta-row" *ngIf="match.referee"><strong>Referee:</strong> <span>{{ match.referee }}</span></div>
      <div class="meta-row" *ngIf="match.league?.name"><strong>Competition:</strong> <span>{{ match.league?.name }}</span></div>
    </section>
  </div>
</ion-content>
