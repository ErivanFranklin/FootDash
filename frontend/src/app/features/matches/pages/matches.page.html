<app-page-header
  [title]="'NAV.MATCHES' | transloco"
  [actions]="[
    { label: 'Fetch', handler: loadMatches.bind(this), icon: 'download', loading: loading },
    { label: 'Sync Fixtures', handler: syncFixtures.bind(this), icon: 'sync', color: 'medium', loading: loading }
  ]">
</app-page-header>

<ion-content [fullscreen]="true">
  <ion-refresher slot="fixed" (ionRefresh)="handleRefresh($event)">
    <ion-refresher-content
      pullingIcon="chevron-down-circle-outline"
      [pullingText]="'COMMON.PULL_TO_REFRESH' | transloco"
      refreshingSpinner="circles"
      [refreshingText]="'COMMON.REFRESHING' | transloco">
    </ion-refresher-content>
  </ion-refresher>

  <!-- Quick Filter Chips -->
  <div class="quick-filters">
    <ion-chip
      *ngFor="let filter of quickFilters"
      [class.chip-selected]="filter.active"
      (click)="toggleQuickFilter(filter)">
      <ion-icon [name]="filter.icon"></ion-icon>
      {{ filter.label }}
    </ion-chip>
  </div>

  <app-form-section title="Match Filters">
    <ion-item>
      <ion-label position="stacked">Season</ion-label>
      <ion-input type="number" [(ngModel)]="season"></ion-input>
    </ion-item>
    <ion-item>
      <ion-label position="stacked">Range</ion-label>
      <ion-input [(ngModel)]="range" placeholder="recent|upcoming|all"></ion-input>
    </ion-item>
    <ion-item>
      <ion-label position="stacked">Limit</ion-label>
      <ion-input type="number" [(ngModel)]="limit"></ion-input>
    </ion-item>
    <ion-item>
      <ion-label position="stacked">From (YYYY-MM-DD)</ion-label>
      <ion-input [(ngModel)]="from" placeholder="2025-01-01"></ion-input>
    </ion-item>
    <ion-item>
      <ion-label position="stacked">To (YYYY-MM-DD)</ion-label>
      <ion-input [(ngModel)]="to" placeholder="2025-12-31"></ion-input>
    </ion-item>
  </app-form-section>

  <div style="padding: 12px;" *ngIf="!fixtures.length && !loading">No fixtures loaded yet.</div>
  
  <!-- Loading skeletons -->
  <div *ngIf="loading">
    <app-match-skeleton *ngFor="let i of [1,2,3,4,5]"></app-match-skeleton>
  </div>

  <!-- Matches List -->
  <div *ngIf="fixtures.length && !loading">
    <a *ngFor="let match of fixtures" [routerLink]="['/match', match.fixture.id]" style="display: block; padding: 8px 12px;">
      <app-match-card [match]="match"></app-match-card>
    </a>
  </div>

  <!-- Infinite Scroll -->
  <ion-infinite-scroll threshold="100px" (ionInfinite)="loadMoreMatches($event)" *ngIf="fixtures.length && !loading">
    <ion-infinite-scroll-content
      loadingSpinner="bubbles"
      loadingText="Loading more matches...">
    </ion-infinite-scroll-content>
  </ion-infinite-scroll>

  <!-- Floating Action Button -->
  <ion-fab vertical="bottom" horizontal="end" slot="fixed">
    <ion-fab-button (click)="loadMatches()">
      <ion-icon name="refresh"></ion-icon>
    </ion-fab-button>
  </ion-fab>
</ion-content>
